<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <style>
    /* --- GENERAL LAYOUT --- */
    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0; padding: 0;
      width: 800px; /* Limita maximÄƒ Chrome */
      background-color: #f8f9fa;
      overflow-x: hidden;
    }

    /* --- Toolbar Superior (Main) --- */
    #controls {
      position: sticky; top: 0; background: #fff; padding: 10px 15px;
      border-bottom: 1px solid #e9ecef; z-index: 100;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }
    
    .row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; gap: 15px; }
    .row:last-child { margin-bottom: 0; }
    .flex-group { display: flex; align-items: center; gap: 8px; }

    /* Inputs Main */
    label { font-size: 11px; color: #555; font-weight: 700; text-transform: uppercase; white-space: nowrap; }
    input { padding: 4px 6px; border: 1px solid #ced4da; border-radius: 4px; font-size: 12px; }
    input[type="number"] { width: 45px; }
    input[type="text"] { width: 100%; }
    .input-wrapper { display: flex; align-items: center; gap: 5px; flex: 1; }
    
    /* Checkboxes */
    .type-check { font-size: 11px; display: flex; align-items: center; gap: 4px; cursor: pointer; font-weight: 500; text-transform: none; color: #333; }
    .type-check input { margin: 0; }
    
    /* Butoane Generale */
    button { padding: 5px 12px; cursor: pointer; border: none; border-radius: 4px; font-size: 12px; font-weight: 600; transition: background 0.2s; white-space: nowrap; }
    .btn-icon { padding: 4px 8px; font-size: 14px; line-height: 1; }
    
    .btn-primary { background-color: #0d6efd; color: white; }
    .btn-primary:hover { background-color: #0b5ed7; }
    .btn-success { background-color: #198754; color: white; }
    .btn-success:hover { background-color: #157347; }
    .btn-success:disabled { background-color: #a3cfbb; cursor: not-allowed; }
    .btn-outline { background-color: transparent; border: 1px solid #ced4da; color: #333; }
    .btn-outline:hover { background-color: #e9ecef; }

    /* --- LISTA IMAGINI --- */
    #status { font-size: 12px; color: #6c757d; font-weight: 600; flex: 1; }
    #imageList { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; padding: 12px; list-style: none; margin: 0; }
    
    li { position: relative; background: #fff; border-radius: 8px; overflow: hidden; cursor: pointer; box-shadow: 0 2px 5px rgba(0,0,0,0.1); aspect-ratio: 1; transition: transform 0.2s; }
    li:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.15); z-index: 10; }
    .img-wrapper { width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; background: #eee; }
    img { max-width: 100%; max-height: 100%; object-fit: cover; }

    /* Action Bar (Hover Thumbnails) */
    .action-bar {
      position: absolute; top: 8px; left: 50%; transform: translateX(-50%);
      background: rgba(255, 255, 255, 0.95); padding: 4px 6px; border-radius: 50px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.25); border: 1px solid #ddd;
      display: flex; gap: 3px; opacity: 0; transition: opacity 0.2s; z-index: 20; white-space: nowrap; 
    }
    li:hover .action-bar { opacity: 1; }
    .mini-btn { width: 24px; height: 24px; background: #fff; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 12px; color: #444; border: 1px solid #eee; transition: all 0.2s; }
    .mini-btn:hover { background: #0d6efd; color: white; border-color: #0d6efd; transform: scale(1.1); }
    .mini-btn.disabled { opacity: 0.3; cursor: default; background: #f0f0f0; }

    /* Overlays */
    .selection-overlay { position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(13, 110, 253, 0.5); display: none; align-items: center; justify-content: center; z-index: 9; }
    li.selected .selection-overlay { display: flex; }
    .check-icon { color: white; font-size: 28px; font-weight: bold; background: rgba(0,0,0,0.2); border-radius: 50%; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; }
    .check-icon::before { content: '\2713'; }
    .meta-size { position: absolute; bottom: 0; right: 0; background: rgba(0,0,0,0.8); color: #fff; font-size: 11px; padding: 3px 6px; border-top-left-radius: 6px; pointer-events: none; font-weight: 600; }
    .meta-ext { position: absolute; bottom: 0; left: 0; background: rgba(0,0,0,0.8); color: #ffc107; font-size: 11px; padding: 3px 6px; border-top-right-radius: 6px; pointer-events: none; text-transform: uppercase; font-weight: bold; }

    /* --- MODAL EDITOR FOTO --- */
    #imageModal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 200; display: none; flex-direction: column; align-items: center; justify-content: center; padding: 20px; box-sizing: border-box; }
    
    #modalImgContainer {
        flex: 1; display: flex; align-items: center; justify-content: center; width: 100%; overflow: hidden;
    }
    #modalImg { max-width: 100%; max-height: 70vh; border: 2px solid #555; box-shadow: 0 0 30px rgba(0,0,0,0.7); }

    /* Modal Toolbar */
    #modalToolbar {
        background: #222; padding: 10px 15px; border-radius: 8px; margin-top: 15px;
        display: flex; flex-direction: column; gap: 8px; border: 1px solid #444; width: 100%; max-width: 700px; min-height: 85px; justify-content: center;
    }

    .tool-row { display: flex; justify-content: space-between; align-items: center; gap: 10px; }
    .tool-group { display: flex; gap: 5px; flex-wrap: wrap; justify-content: center; }

    /* Butoane Editor */
    .tool-btn {
        background: #333; color: #ddd; border: 1px solid #555; padding: 6px 12px;
        border-radius: 4px; cursor: pointer; font-size: 11px; font-weight: 600;
        transition: all 0.2s; display: flex; align-items: center; gap: 5px; white-space: nowrap;
    }
    .tool-btn:hover { background: #444; color: #fff; border-color: #777; }
    .tool-btn:active { transform: scale(0.98); }
    
    .tool-btn.primary { background: #0d6efd; color: white; border-color: #0a58ca; }
    .tool-btn.primary:hover { background: #0b5ed7; }
    
    .tool-btn.magic { background: #6f42c1; color: white; border-color: #59359a; }
    .tool-btn.magic:hover { background: #5e37a6; }

    .tool-btn.success { background: #198754; color: white; border-color: #157347; }
    .tool-btn.success:hover { background: #146c43; }

    .tool-btn.danger { background: #dc3545; color: white; border-color: #b02a37; }
    .tool-btn.danger:hover { background: #bb2d3b; }

    #processStatus { color: #aaa; font-size: 11px; text-align: center; height: 15px; margin-bottom: 5px; }
    #closeModal { position: absolute; top: 15px; right: 20px; font-size: 30px; color: #888; cursor: pointer; z-index: 210; }
    #closeModal:hover { color: #fff; }

  </style>
</head>
<body>
  
  <div id="controls">
    <div class="row">
      <div class="flex-group">
        <label>Min:</label>
        <input type="number" id="minWidth" value="50"><span>x</span><input type="number" id="minHeight" value="50">
        <button id="rescanBtn" class="btn-outline btn-icon" title="Rescan">&#8635;</button>
      </div>
      <div class="flex-group">
        <label style="color:#aaa;">|</label>
        <label class="type-check"><input type="checkbox" checked value="jpg"> JPG</label>
        <label class="type-check"><input type="checkbox" checked value="png"> PNG</label>
        <label class="type-check"><input type="checkbox" checked value="webp"> WebP</label>
        <label class="type-check"><input type="checkbox" checked value="svg"> SVG</label>
        <label style="color:#aaa;">|</label>
        <label class="type-check" style="color:#d63384; font-weight:700;"><input type="checkbox" id="convertWebp"> WebP2PNG</label>
      </div>
    </div>
    <div class="row">
        <div class="input-wrapper" style="flex: 2;"><label>Filter:</label><input type="text" id="filterText" placeholder="Name or Alt text..."></div>
        <div class="input-wrapper"><label>Folder:</label><input type="text" id="subfolderName" placeholder="Subfolder"></div>
        <div class="input-wrapper"><label>Rename:</label><input type="text" id="renamePattern" placeholder="Prefix"></div>
    </div>
    <div class="row" style="margin-top: 10px; border-top: 1px solid #eee; padding-top: 8px;">
      <div id="status">Scanning...</div>
      <div class="flex-group">
        <button id="selectAllBtn" class="btn-primary">Select All</button>
        <button id="downloadBtn" class="btn-success" disabled>Download</button>
      </div>
    </div>
  </div>

  <ul id="imageList"></ul>

  <div id="imageModal">
    <div id="closeModal">&times;</div>
    
    <div id="modalImgContainer">
        <img id="modalImg" src="">
    </div>

    <div id="processStatus">Ready to edit</div>

    <div id="modalToolbar">
        
        <div id="defaultTools">
            <div class="tool-row">
                <span style="color:#888; font-size:10px; text-transform:uppercase; font-weight:bold;">Manual:</span>
                <div class="tool-group">
                    <button class="tool-btn" id="btnCrop" title="Crop 2%">âœ‚ Crop</button>
                    <button class="tool-btn" id="btnResize" title="Resize">ðŸ“‰ Resize</button>
                    <button class="tool-btn" id="btnFlip" title="Mirror">â†” Flip</button>
                    <button class="tool-btn" id="btnNoise" title="Grain">â–‘ Noise</button>
                    <button class="tool-btn" id="btnColor" title="Hue">ðŸŽ¨ Color</button>
                    
                    <button class="tool-btn" id="btnObfuscate" title="Blur+Sharpen">ðŸ’§ Obfuscate</button>
                    <button class="tool-btn" id="btnRecompress" title="JPEG">ðŸ“¦ Re-JPEG</button>
                </div>
                <button class="tool-btn" id="btnRotate" title="Rotate">â†»</button>
            </div>

            <div class="tool-row" style="border-top:1px solid #444; padding-top:8px; margin-top:8px;">
                <div class="tool-group">
                    <button class="tool-btn magic" id="btnMagic">âš¡ Magic Cascade</button>
                    <button class="tool-btn danger" id="btnReset">âœ• Reset</button>
                </div>
                
                <div class="tool-group">
                    <button class="tool-btn success" id="btnDownloadSingle">ðŸ’¾ Download Result</button>
                </div>
            </div>
        </div>

        <div id="activeToolPanel" style="display:none; align-items:center; justify-content:center; width:100%; height: 100%;">
            <div style="display:flex; align-items:center; gap:15px; background: #333; padding: 10px 20px; border-radius: 6px; border: 1px solid #555;">
                
                <div style="display:flex; align-items:center; gap:10px;">
                    <span id="toolLabel" style="color:#fff; font-size:13px; font-weight:bold;">Setting:</span>
                    <input type="number" id="toolInput" style="width:70px; padding:6px; border-radius:4px; border:1px solid #666; background:#222; color:white; font-weight:bold; text-align:center;">
                    <span id="toolUnit" style="color:#aaa; font-size:12px;">%</span>
                </div>

                <div style="width: 1px; height: 25px; background: #555; margin: 0 5px;"></div>

                <div class="tool-group">
                    <button class="tool-btn success" id="btnApplyTool">âœ” Apply</button>
                    <button class="tool-btn danger" id="btnCancelTool">âœ• Cancel</button>
                </div>
            </div>
        </div>

    </div>
  </div>

  <canvas id="conversionCanvas" style="display:none;"></canvas>
  <canvas id="editorCanvas" style="display:none;"></canvas> 
  
  <script src="popup.js"></script>
</body>
</html>